---
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { buttonVariants } from '@/components/ui/button';
import '@/styles/globals.css';
---

<!doctype html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>Damos-te as boas-vindas!</title>
  </head>
  <body class="bg-background text-foreground">
    <div class="min-h-screen flex items-center justify-center px-6">
      <div class="w-full max-w-md space-y-6 rounded-xl border bg-card p-8 shadow">
        <header class="space-y-2 text-center">
          <h1 class="text-3xl font-bold">Damos-te as boas-vindas!</h1>
          <p class="text-sm text-muted-foreground">
            Guarda o teu nome e e-mail para usarmos mais tarde no dashboard.
          </p>
        </header>

        <form id="welcome-form" class="space-y-4">
          <div class="space-y-2 text-left">
            <Label htmlFor="name">Nome</Label>
            <Input id="name" name="name" type="text" required placeholder="A tua identificacao" />
          </div>
          <div class="space-y-2 text-left">
            <Label htmlFor="email">E-mail</Label>
            <Input id="email" name="email" type="email" required placeholder="nome@exemplo.com" />
          </div>
          <button type="submit" class={buttonVariants({ size: 'lg' })}>
            Guardar
          </button>
          <p id="save-message" class="text-sm text-green-600 hidden">
            Informacao guardada com sucesso!
          </p>
        </form>
      </div>
    </div>

    <script is:inline>
      const COOKIE_NAME_KEY = 'lumio_name';
      const COOKIE_EMAIL_KEY = 'lumio_email';
      const ONE_YEAR_SECONDS = 60 * 60 * 24 * 365;

      const form = document.getElementById('welcome-form');
      const nameInput = document.getElementById('name');
      const emailInput = document.getElementById('email');
      const message = document.getElementById('save-message');

      const getCookie = (key) => {
        const entries = document.cookie
          .split('; ')
          .filter(Boolean)
          .map((row) => row.split('='));

        for (const [cookieKey, value] of entries) {
          if (decodeURIComponent(cookieKey) === key) {
            return decodeURIComponent(value ?? '');
          }
        }
        return '';
      };

      const setCookie = (key, value) => {
        document.cookie = `${encodeURIComponent(key)}=${encodeURIComponent(value)}; path=/; max-age=${ONE_YEAR_SECONDS}; samesite=lax`;
      };

      const savedName = getCookie(COOKIE_NAME_KEY);
      const savedEmail = getCookie(COOKIE_EMAIL_KEY);

      if (savedName) {
        nameInput.value = savedName;
      }

      if (savedEmail) {
        emailInput.value = savedEmail;
      }

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const nameValue = nameInput.value.trim();
        const emailValue = emailInput.value.trim();

        setCookie(COOKIE_NAME_KEY, nameValue);
        setCookie(COOKIE_EMAIL_KEY, emailValue);

        message.classList.remove('hidden');
        message.textContent = 'Informacao guardada com sucesso!';
      });
    </script>
  </body>
</html>
